general:
  branches:
    ignore:
      - gh-pages
checkout:
  post:
    - git submodule init
    - git submodule update
machine:
  timezone: Asia/Tokyo
  node:
    version: 9.3.0
test:
  override:
    - npm run build -- --env.prod && npm test
    - sh -x common/e2e.sh
  post:
    - sh release.sh
deployment:
  deploy:
    branch: master
    commands:
      - npm run doc
      - >-
        aws s3 cp ./docs/ s3://api.grimoire.gl/$CIRCLE_PROJECT_REPONAME
        --recursive --acl public-read
